<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>index</title>
    <link href="statics/icon/favicon.ico" type="image/x-icon" rel="icon">
    <link href="statics/icon/favicon.ico" type="image/x-icon" rel="shortcut icon">
    <script src="statics/js/jquery-3.4.1.min.js" crossorigin="anonymous"></script>
    <!-- <script src="statics/js/js.cookie.min.js" crossorigin="anonymous"></script> -->
    <script src="https://cdn.jsdelivr.net/npm/js-cookie@rc/dist/js.cookie.min.js"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css"
        integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous">

    <script type="text/javascript">
        $(document).ready(function () {
            // 檢查有沒有登入
            if (Cookies.get('memberName') === undefined) {
                // 尚未登入
                $('#login-div').show();
                $('#logout-div').hide();
            } else {
                // 已登入
                $('#login-div').hide();
                $('#logout-div').show();

                showWelcomeMessage(Cookies.get('memberName'), Cookies.get('memberIsAdmin') === 'true')
            }

            function showWelcomeMessage(name, isAdmin) {
                $('#message').text('歡迎回來！' + (isAdmin ? "管理員" : "會員") + " " + name);
            }

            // 登出
            $('#logout-button').click(function () {
                Cookies.remove('memberName');
                Cookies.remove('memberIsAdmin');
                alert('已登出');
                location.reload();
            })

            // 登入
            $('#login-button').click(function () {
                let request = {
                    'email': $('#email').val(),
                    'password': $('#password').val(),
                };

                let data_string = JSON.stringify(request);

                $.ajax({
                    type: "POST",
                    url: "api/login.do",
                    crossDomain: true,
                    data: data_string,
                    cache: false,
                    dataType: 'json',
                    timeout: 5000,
                    success: function (response) {
                        if (response.status == 200) {
                            alert('登入成功');
                            location.reload();
                        } else if (response.status = 401) {
                            alert('帳號密碼錯誤');
                            $('#email').text('');
                            $('#password').text('');
                        }
                        console.log(response);
                    },
                    error: function (jqXHR, exception) {
                        var msg = '';
                        if (jqXHR.status === 0) {
                            msg = 'Not connect.\n Verify Network.';
                        } else if (jqXHR.status == 404) {
                            msg = 'Requested page not found. [404]';
                        } else if (jqXHR.status == 500) {
                            msg = 'Internal Server Error [500].';
                        } else if (exception === 'parsererror') {
                            msg = 'Requested JSON parse failed.';
                        } else if (exception === 'timeout') {
                            msg = 'Time out error.';
                        } else if (exception === 'abort') {
                            msg = 'Ajax request aborted.';
                        } else {
                            msg = 'Uncaught Error.\n' + jqXHR.responseText;
                        }
                        alert(msg);
                    },
                });
            })

        });
    </script>
    <style>
        .center {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 300px;
        }
    </style>
</head>

<body>
    <div class="center">
        <div class="center" id="login-div">
            <table>
                <tr>
                    <td>伊媚兒：</td>
                    <td><input type="text" id="email"></td>
                </tr>
                <tr>
                    <td align="right">密碼：</td>
                    <td><input type="password" id="password"></td>
                </tr>
            </table>
            <br>
            <input type="button" id="login-button" value="登入">
        </div>
        <p id="message"></p>
        <div id="logout-div" style="display: none;">
            <input type="button" id="logout-button" value="登出">
        </div>
    </div>
</body>

</html>